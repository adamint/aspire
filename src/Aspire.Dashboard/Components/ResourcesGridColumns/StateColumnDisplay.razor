@using Aspire.Dashboard.Model
@using Aspire.Dashboard.Otlp.Model
@using Aspire.Dashboard.Resources
@inject IStringLocalizer<Columns> Loc

<div class="resource-state-container">
    @if (Resource is { State: ResourceStates.ExitedState /* containers */ or ResourceStates.FinishedState /* executables */, ExitCode: not null and not 0 })
    {
        var iconId = $"state-icon-{Resource.GetHashCode()}";
        <!-- process completed unexpectedly, hence the non-zero code. this is almost certainly an error, so warn users -->
        <FluentIcon Id="@iconId" Icon="Icons.Filled.Size16.ErrorCircle" Color="Color.Error" Class="severity-icon" />
        <FluentTooltip Anchor="@iconId">
            @string.Format(Loc[Columns.StateColumnResourceExitedUnexpectedly], Resource.ResourceType, Resource.ExitCode)
        </FluentTooltip>
    }
    else if (Resource is { State: ResourceStates.ExitedState /* containers */ or ResourceStates.FinishedState /* containers */ })
    {
        var iconId = $"state-icon-{Resource.GetHashCode()}";
        <!-- process completed, which may not have been unexpected -->
        <FluentIcon Id="@iconId" Icon="Icons.Filled.Size16.Warning" Color="Color.Warning" Class="severity-icon" />
        <FluentTooltip Anchor="@iconId">
            @string.Format(Loc[Columns.StateColumnResourceExited], Resource.ResourceType)
        </FluentTooltip>
    }

    @Resource.State
    <UnreadLogErrorsBadge UnviewedCount="@GetUnviewedErrorCount(Resource)" Resource="@Resource" />
</div>

@code {
    [Parameter, EditorRequired]
    public Dictionary<OtlpApplication, int>? UnviewedErrorCounts { get; set; }

    [Parameter, EditorRequired]
    public required ResourceViewModel Resource { get; set; }
}
